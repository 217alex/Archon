#!/bin/bash
echo
echo '-------------------------------------'
echo 'Τροποποίηση Γλώσσας και Ζώνης Ώρας'
echo '-------------------------------------'
echo
echo "en_US.UTF-8 UTF-8" >> /etc/locale.gen
locale-gen
echo LANG=en_US.UTF-8 > /etc/locale.conf
export LANG=en_US.UTF-8
ln -sf /usr/share/zoneinfo/Europe/Athens /etc/localtime
hwclock --systohc
echo
read -rp "Δώστε όνομα υπολογιστή (hostname): " hostvar
echo "$hostvar" > /etc/hostname
echo
echo '-------------------------------------'
echo 'Ρύθμιση της κάρτας δικτύου'
echo '-------------------------------------'
ethernet=$(ip link | grep "2: "| grep -oE "(en\\w+)")
systemctl enable dhcpcd@"$ethernet".service
echo
echo "Η κάρτα δικτύου $ethernet ρυθμίστηκε επιτυχώς";
echo
wifi=$(ip link | grep ": "| grep -oE "(w\\w+)")                   # Αναζήτηση κάρτας wifi
if [ "$wifi" = "" ]; then					  # Έλεγχος αν υπάρχει κάρτα wifi
       echo "Δε βρέθηκε ασύρματη κάρτα δικτύου"			  # και αν υπάρχει γίνεται εγκατάσταση
else 								  # και ενεργοποίηση
       pacman -S --noconfirm iw wpa_supplicant dialog wpa_actiond
       systemctl enable netctl-auto@"$wifi".service
       echo "Η ασύρματη κάρτα δικτύου $wifi ρυθμίστηκε επιτυχώς"
fi
echo '-------------------------------------'
echo 'Αλλαγή συνθηματικού(password) '
echo 'του root χρήστη'
echo '-------------------------------------'
passwd
echo
echo '-------------------------------------'
echo 'Ρύθμιση Bootloader'
echo '-------------------------------------'
echo
if [ -d /sys/firmware/efi ]; then
	pacman -S --noconfirm grub efibootmgr os-prober
	grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=arch_grub --recheck
	grub-mkconfig -o /boot/grub/grub.cfg
else
	pacman -S --noconfirm grub os-prober
	read -rp " Σε ποιο δίσκο θέλετε να εγκατασταθεί ο grub (/dev/sd?); " grubvar
	grub-install --target=i386-pc --recheck "$grubvar"
	grub-mkconfig -o /boot/grub/grub.cfg
fi

echo
echo '-------------------------------------'
echo 'Δημιουργία νέου χρήστη και'
echo 'δικαιώματα διαχειριστή'
echo '-------------------------------------'
echo
read -rp "Δώστε παρακαλώ νέο όνομα χρήστη: " onomaxristi
useradd -m -G wheel -s /bin/bash "$onomaxristi"
passwd "$onomaxristi"
echo "$onomaxristi ALL=(ALL) ALL" >> /etc/sudoers
echo
echo '-------------------------------------'
echo 'Προσθήκη Multilib και AUR'
echo '-------------------------------------'
echo
{
        echo "[multilib]"
        echo "Include = /etc/pacman.d/mirrorlist"
        echo "[archlinuxfr]"
        echo "SigLevel = Never"
        echo "Server = http://repo.archlinux.fr/\$arch" 
} >> /etc/pacman.conf
pacman -Syy --noconfirm yaourt
############################ Installing Zswap ###############################
pacman -S --noconfirm systemd-swap
# τα default του developer αλλάζουμε μόνο:
sed -i 's/zswap_enabled=1/zswap_enabled=0/g' /etc/systemd/swap.conf #default είναι 1, αλλά δεν ξέρουμε πόση RAM έχει γιαυτό το κάμνουμε disable
sed -i 's/swapfc_enabled=0/swapfc_enabled=1/g' /etc/systemd/swap.conf
systemctl enable systemd-swap
